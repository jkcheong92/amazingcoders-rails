<div id="deal_type" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<footer>
  <!--Sand-Signika theme for Highcharts JS-->
  <script>
      // Load the fonts
      Highcharts.createElement('link', {
          href: '//fonts.googleapis.com/css?family=Signika:400,700',
          rel: 'stylesheet',
          type: 'text/css'
      }, null, document.getElementsByTagName('head')[0]);

      // Add the background image to the container
      Highcharts.wrap(Highcharts.Chart.prototype, 'getContainer', function (proceed) {
          proceed.call(this);
          this.container.style.background = 'url(http://www.highcharts.com/samples/graphics/sand.png)';
      });


      Highcharts.theme = {
          colors: ["#f45b5b", "#8085e9", "#8d4654", "#7798BF", "#aaeeee", "#ff0066", "#eeaaee",
              "#55BF3B", "#DF5353", "#7798BF", "#aaeeee"],
          chart: {
              backgroundColor: null,
              style: {
                  fontFamily: "Signika, serif"
              }
          },
          title: {
              style: {
                  color: 'black',
                  fontSize: '16px',
                  fontWeight: 'bold'
              }
          },
          subtitle: {
              style: {
                  color: 'black'
              }
          },
          tooltip: {
              borderWidth: 0
          },
          legend: {
              itemStyle: {
                  fontWeight: 'bold',
                  fontSize: '13px'
              }
          },
          xAxis: {
              labels: {
                  style: {
                      color: '#6e6e70'
                  }
              }
          },
          yAxis: {
              labels: {
                  style: {
                      color: '#6e6e70'
                  }
              }
          },
          plotOptions: {
              series: {
                  shadow: true
              },
              candlestick: {
                  lineColor: '#404048'
              },
              map: {
                  shadow: false
              }
          },

          // Highstock specific
          navigator: {
              xAxis: {
                  gridLineColor: '#D0D0D8'
              }
          },
          rangeSelector: {
              buttonTheme: {
                  fill: 'white',
                  stroke: '#C0C0C8',
                  'stroke-width': 1,
                  states: {
                      select: {
                          fill: '#D0D0D8'
                      }
                  }
              }
          },
          scrollbar: {
              trackBorderColor: '#C0C0C8'
          },

          // General
          background2: '#E0E0E8'

      };

      // Apply the theme
      Highcharts.setOptions(Highcharts.theme);
  </script>
  <!--Pie Chart-->
  <script>
      $(function () {
          var chart = new Highcharts.Chart({
              credits: {
                  enabled: false
              },
              chart: {
                  type: 'pie',
                  renderTo: 'deal_type',
                  events: {
                      drilldown: function (e) {
                          chart.setTitle({text: "Popularity of Deal of Deal Type " + e.point.name});
                      },
                      drillup: function (e) {
                          chart.setTitle({text: 'Popularity of Deal Types'});
                      }
                  }
              },
              title: {
                  text: 'Popularity of Deal Types'
              },
              subtitle: {
                  text: 'Redemption Count'
              },
              tooltip: {
                  headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
                  pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.percentage:.2f}%</b> of total<br/>',
              },
              plotOptions: {
                  pie: {
                      allowPointSelect: true,
                      cursor: 'pointer',
                      depth: 35,
                      dataLabels: {
                          enabled: true,
                          format: '{point.name} ' + '<span style="color: #0f1cda">{point.y} Redemptions </span>'
                      },
                      showInLegend: true
                  }
              },
              series: [{
                  name: "Deal Type",
                  colorByPoint: true,
                  data: [
                      <% num_of_deal_types = @deals_popularity_by_type_and_redemption.size %>
                      <% loop = 0 %>
                      <% while loop < num_of_deal_types %>
                      <% last_variable = @deals_popularity_by_type_and_redemption[loop].size - 1 %>
                      {
                          name: "<%= @deals_popularity_by_type_and_redemption[loop][0] %>",
                          y: <%= @deals_popularity_by_type_and_redemption[loop][last_variable]%>,
                          drilldown: "<%= @deals_popularity_by_type_and_redemption[loop][0] %>"
                      },
                      <% loop = loop + 1 %>
                      <% end %>
                  ]
              }],

              drilldown: {
                  series: [
                      <% loop = 0 %>
                      <% while loop < num_of_deal_types %>
                      <% num_of_deal_in_deal_type = @deals_popularity_by_type_and_redemption[loop].size - 1 %>
                      <% inner_loop = 1 %>
                      {
                          name: "<%= @deals_popularity_by_type_and_redemption[loop][0] %>",
                          id: "<%= @deals_popularity_by_type_and_redemption[loop][0] %>",
                          data: [
                              <% while inner_loop < num_of_deal_in_deal_type %>
                              ["<%= @deals_popularity_by_type_and_redemption[loop][inner_loop][0] %>", <%=@deals_popularity_by_type_and_redemption[loop][inner_loop][1] %>],
                              <% inner_loop = inner_loop + 1 %>
                              <% end %>
                          ]
                      },
                      <% loop = loop + 1 %>
                      <% end %>
                  ]
              }
          });
      });
  </script>
</footer>