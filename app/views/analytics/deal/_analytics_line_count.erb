<head>
  <script src="http://code.highcharts.com/stock/highstock.js"></script>
  <script src="http://code.highcharts.com/stock/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/drilldown.js"></script>
</head>

<div id="analytics_line" style="min-width: 310px; height: 400px; margin: 0 auto"></div>

<footer>

  <style type="text/css">
      .container {
          border: 2px solid #ccc;
          width: 500px;
          height: 100px;
          overflow-y: scroll;
          float: left;
      }
  </style>

  <script>
      $(function () {
          Highcharts.setOptions({
              global: {
                  useUTC: false
              }
          });
          $('#analytics_line').highcharts('StockChart', {
              credits: {
                  enabled: false
              },
              title: {
                  text: 'Analytics of Deals'
              },
              subtitle: {
                  text: 'View Count and Redemption Count'
              },
              rangeSelector: {
                  allButtonsEnabled: true,
                  buttons: [{
                      type: 'month',
                      count: 3,
                      text: 'Day',
                      dataGrouping: {
                          forced: true,
                          units: [['day', [1]]]
                      }
                  }, {
                      type: 'year',
                      count: 1,
                      text: 'Week',
                      dataGrouping: {
                          forced: true,
                          units: [['week', [1]]]
                      }
                  }],
                  buttonTheme: {
                      width: 60
                  },
              },

              yAxis: {
                  floor: 0,
                  title: {
                      text: 'Number'
                  }
              },

              plotOptions: {
                  dataLabels: {
                      visible: true
                  },
                  series: {
                      compare: 'value'
                  }
              },
              tooltip: {
                  pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b><br/>',
                  valueDecimals: 2
              },
              legend: {
                  enabled: true,
                  align: 'right',
                  backgroundColor: '#FCFFC5',
                  borderColor: 'black',
                  borderWidth: 2,
                  layout: 'vertical',
                  verticalAlign: 'top',
                  y: 100,
                  shadow: true
              },

              series: [
                  <% num_active_deals = @deals_daily_count[0].size %>
                  <% num = 0 %>
                  <% while num < num_active_deals %>
                  {
                      id: "<%= @deals_daily_count[0][num][0] %>" + ' (View Count)',
                      name: '<span style="color: #00910c">Active: </span>' + "<%= @deals_daily_count[0][num][0] %>" + '<span style="color: #9d1bcf"> (View Count)</span>',
                      pointStart: <%= @deals_daily_count[0][num][1] %>,
                      pointInterval: 24 * 3600 * 1000,
                      data: <%= @deals_daily_count[0][num][2] %>,
                      visible: true
                  }, {
                      id: "<%= @deals_daily_count[0][num][0] %>" + ' (Redemption Count)',
                      name: '<span style="color: #00910c">Active: </span>' + "<%= @deals_daily_count[0][num][0] %>" + '<span style="color: #eb8100"> (Redemption Count)</span>',
                      pointStart: <%= @deals_daily_count[0][num][1] %>,
                      pointInterval: 24 * 3600 * 1000,
                      data: <%= @deals_daily_count[0][num][3] %>,
                      visible: true
                  },
                  <% num = num + 1 %>
                  <% end %>

                  <% num_of_expired_deals = @deals_daily_count[2].size %>
                  <% loops = 0 %>
                  <% while loops < num_of_expired_deals %>
                  {
                      id: "<%= @deals_daily_count[1][loops][0] %>" + ' (View Count)',
                      name: '<span style="color: #df1007">Expired: </span>' + "<%= @deals_daily_count[1][loops][0] %>" + '<span style="color: #9d1bcf"> (View Count)</span>',
                      pointStart: <%= @deals_daily_count[1][loops][1] %>,
                      pointInterval: 24 * 3600 * 1000,
                      data: <%= @deals_daily_count[1][loops][2] %>,
                      visible: false
                  }, {
                      id: "<%= @deals_daily_count[1][loops][0] %>" + ' (Redemption Count)',
                      name: '<span style="color: #df1007">Expired: </span>' + "<%= @deals_daily_count[1][loops][0] %>" + '<span style="color: #eb8100"> (Redemption Count)</span>',
                      pointStart: <%= @deals_daily_count[1][loops][1] %>,
                      pointInterval: 24 * 3600 * 1000,
                      data: <%= @deals_daily_count[1][loops][3] %>,
                      visible: false
                  },
                  <% loops = loops + 1 %>
                  <% end %>
              ]
          }, function (chart) {

              // apply the date pickers
              setTimeout(function () {
                  $('input.highcharts-range-selector', $(chart.container).parent())
                          .datepicker();
              }, 0);
          });

          // Set the datepicker's date format
          $.datepicker.setDefaults({
              dateFormat: 'yy-mm-dd',
              onSelect: function () {
                  this.onchange();
                  this.onblur();
              }
          });
      });
  </script>
</footer>